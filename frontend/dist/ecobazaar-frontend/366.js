"use strict";(self.webpackChunkecobazaar=self.webpackChunkecobazaar||[]).push([[366],{366:(k,m,n)=>{n.r(m),n.d(m,{ProfileComponent:()=>I});var f=n(2881),s=n(9417),l=n(5596),g=n(6704),d=n(6863),p=n(8834),_=n(9980),u=n(3443),h=n(8010),e=n(1360),E=n(5567),c=n(2928);function F(t,a){1&t&&(e.j41(0,"div",6),e.EFF(1," Loading profile... "),e.k0s())}function P(t,a){if(1&t&&(e.j41(0,"div",7),e.EFF(1),e.k0s()),2&t){const o=e.XpG();e.R7$(),e.SpI(" ",o.errorMessage," ")}}function v(t,a){if(1&t&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&t){const o=e.XpG();e.R7$(),e.SpI(" ",o.successMessage," ")}}function M(t,a){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Name is required "),e.k0s())}function b(t,a){if(1&t){const o=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(o);const r=e.XpG(2);return e.Njj(r.toggleEdit())}),e.j41(1,"mat-icon"),e.EFF(2,"edit"),e.k0s(),e.EFF(3," Edit Profile "),e.k0s()}}function C(t,a){if(1&t){const o=e.RV6();e.j41(0,"div",23)(1,"button",24),e.bIt("click",function(){e.eBV(o);const r=e.XpG(2);return e.Njj(r.toggleEdit())}),e.EFF(2,"Cancel"),e.k0s(),e.j41(3,"button",25),e.bIt("click",function(){e.eBV(o);const r=e.XpG(2);return e.Njj(r.saveProfile())}),e.j41(4,"mat-icon"),e.EFF(5,"save"),e.k0s(),e.EFF(6),e.k0s()()}if(2&t){const o=e.XpG(2);e.R7$(3),e.Y8G("disabled",o.isLoading||o.profileForm.invalid),e.R7$(3),e.SpI(" ",o.isLoading?"Saving...":"Save Changes"," ")}}function x(t,a){if(1&t&&(e.j41(0,"form",9)(1,"div",10)(2,"h3"),e.EFF(3,"Personal Information"),e.k0s(),e.j41(4,"mat-form-field",11)(5,"mat-label"),e.EFF(6,"Full Name"),e.k0s(),e.nrm(7,"input",12),e.DNE(8,M,2,0,"mat-error",13),e.k0s(),e.j41(9,"mat-form-field",11)(10,"mat-label"),e.EFF(11,"Email"),e.k0s(),e.nrm(12,"input",14),e.j41(13,"mat-hint"),e.EFF(14,"Email cannot be changed"),e.k0s()(),e.j41(15,"mat-form-field",11)(16,"mat-label"),e.EFF(17,"Phone"),e.k0s(),e.nrm(18,"input",15),e.k0s(),e.j41(19,"mat-form-field",11)(20,"mat-label"),e.EFF(21,"Address"),e.k0s(),e.nrm(22,"textarea",16),e.k0s()(),e.j41(23,"div",10)(24,"h3"),e.EFF(25,"Account Information"),e.k0s(),e.j41(26,"mat-form-field",11)(27,"mat-label"),e.EFF(28,"Role"),e.k0s(),e.nrm(29,"input",17),e.k0s(),e.j41(30,"mat-form-field",11)(31,"mat-label"),e.EFF(32,"Eco Score"),e.k0s(),e.nrm(33,"input",18),e.j41(34,"mat-hint"),e.EFF(35,"Your sustainability score based on purchases"),e.k0s()()(),e.j41(36,"div",19),e.DNE(37,b,4,0,"button",20)(38,C,7,2,"div",21),e.k0s()()),2&t){let o;const i=e.XpG();e.Y8G("formGroup",i.profileForm),e.R7$(8),e.Y8G("ngIf",null==(o=i.profileForm.get("name"))?null:o.hasError("required")),e.R7$(29),e.Y8G("ngIf",!i.isEditing),e.R7$(),e.Y8G("ngIf",i.isEditing)}}let I=(()=>{class t{constructor(o,i,r,O){this.fb=o,this.userService=i,this.authService=r,this.notificationService=O,this.user=null,this.isLoading=!1,this.isEditing=!1,this.successMessage="",this.errorMessage="",this.profileForm=this.fb.group({name:["",[s.k0.required]],email:[{value:"",disabled:!0}],phone:[""],address:[""],role:[{value:"",disabled:!0}],ecoScore:[{value:0,disabled:!0}]})}ngOnInit(){this.loadProfile()}loadProfile(){this.isLoading=!0,this.userService.getCurrentUser().subscribe({next:o=>{this.user=o,this.profileForm.patchValue({name:o.name,email:o.email,phone:o.phone||"",address:o.address||"",role:o.role,ecoScore:o.ecoScore||0}),this.isLoading=!1},error:o=>{console.error("Error loading profile:",o),this.errorMessage="Failed to load profile",this.isLoading=!1}})}toggleEdit(){this.isEditing=!this.isEditing,this.isEditing?(this.profileForm.get("name")?.enable(),this.profileForm.get("phone")?.enable(),this.profileForm.get("address")?.enable()):(this.profileForm.get("name")?.disable(),this.profileForm.get("phone")?.disable(),this.profileForm.get("address")?.disable(),this.loadProfile())}saveProfile(){this.profileForm.valid&&(this.isLoading=!0,this.successMessage="",this.errorMessage="",this.userService.updateProfile({name:this.profileForm.value.name,phone:this.profileForm.value.phone,address:this.profileForm.value.address}).subscribe({next:i=>{this.user=i,this.successMessage="Profile updated successfully!",this.notificationService.showSuccess("Profile updated successfully!"),this.isEditing=!1,this.profileForm.get("name")?.disable(),this.profileForm.get("phone")?.disable(),this.profileForm.get("address")?.disable(),this.isLoading=!1,i.name&&localStorage.setItem("name",i.name)},error:i=>{console.error("Error updating profile:",i);const r=i.error?.message||"Failed to update profile";this.errorMessage=r,this.notificationService.showError(r),this.isLoading=!1}}))}getRoleLabel(o){return{USER:"User",SELLER:"Seller",ADMIN:"Admin"}[o]||o}static{this.\u0275fac=function(i){return new(i||t)(e.rXU(s.ok),e.rXU(u.D),e.rXU(h.u),e.rXU(E.J))}}static{this.\u0275cmp=e.VBU({type:t,selectors:[["app-profile"]],decls:12,vars:4,consts:[[1,"profile-container"],[1,"profile-card"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"loading"],[1,"error-message"],[1,"success-message"],[3,"formGroup"],[1,"profile-section"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","email","readonly",""],["matInput","","formControlName","phone"],["matInput","","formControlName","address","rows","3"],["matInput","","formControlName","role","readonly",""],["matInput","","formControlName","ecoScore","readonly",""],[1,"profile-actions"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","edit-actions",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],[1,"edit-actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon"),e.EFF(5,"person"),e.k0s(),e.EFF(6," My Profile "),e.k0s()(),e.j41(7,"mat-card-content"),e.DNE(8,F,2,0,"div",2)(9,P,2,1,"div",3)(10,v,2,1,"div",4)(11,x,39,4,"form",5),e.k0s()()()),2&i&&(e.R7$(8),e.Y8G("ngIf",r.isLoading&&!r.user),e.R7$(),e.Y8G("ngIf",r.errorMessage),e.R7$(),e.Y8G("ngIf",r.successMessage),e.R7$(),e.Y8G("ngIf",r.user))},dependencies:[f.MD,f.bT,s.X1,s.qT,s.me,s.BC,s.cb,s.YS,s.j4,s.JD,l.Hu,l.RN,l.m2,l.MM,l.dh,g.M,c.j,c.M,c.c,c.b,d.fS,d.fg,p.Hl,p.$z,_.m_,_.An],styles:[".profile-container[_ngcontent-%COMP%]{padding:24px;max-width:900px;margin:0 auto;min-height:calc(100vh - 64px)}.profile-card[_ngcontent-%COMP%]{width:100%;background:#fff}mat-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:24px}mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px}.profile-section[_ngcontent-%COMP%]{margin-bottom:32px}.profile-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:16px;color:#333;font-size:18px;border-bottom:2px solid #4caf50;padding-bottom:8px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.profile-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:24px;padding-top:24px;border-top:1px solid #eee}.edit-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.loading[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.error-message[_ngcontent-%COMP%]{color:#f44336;background-color:#ffebee;padding:12px;border-radius:4px;margin-bottom:16px}.success-message[_ngcontent-%COMP%]{color:#4caf50;background-color:#e8f5e9;padding:12px;border-radius:4px;margin-bottom:16px}"]})}}return t})()}}]);